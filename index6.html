<!DOCTYPE html>
<html>

  <head>

  <!-- custom CSS -->
  <link rel="stylesheet" href="style.css" type="text/css" media="all" />
  </head>

  <body>
    
    <div id="Stats-output"></div>
    <!-- Div which will hold the Output -->
    <div id="WebGL-output"></div>
<div id="buttondiv"> <button id="change" type="button">Click Me!</button> </div>
  </body>


<script type="x-shader/x-vertex" id="vertexshader">
    attribute vec3 in_Position;
    varying vec2 fragCoord;
    varying vec2 vUv; 
    void main()
    {
        vUv = uv;
        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0 );
        gl_Position = projectionMatrix * mvPosition;
        fragCoord = position.xy;
    }
</script>

<script type="x-shader/x-fragment" id="fragmentshader">
	 uniform float iTime;
         uniform vec2 iResolution;
         uniform vec4 iMouse;
         uniform sampler2D iChannel0;
         varying vec2 fragCoord;
         varying vec2 vUv;
    

#define PI 3.14159265359

vec3 hsv2rgb( in vec3 c ) {
    float frac = fract(c.x)*6.0;
    vec3 col = smoothstep(vec3(3,0,3),vec3(2,2,4),vec3(frac));
    col += smoothstep(vec3(4,3,4),vec3(6,4,6),vec3(frac)) * vec3(1, -1, -1);
    return mix(vec3(1), col, c.y) * c.z;
}

float sdCapsule( vec2 p, vec2 a, vec2 b, float r ) {
	vec2 pa = p - a, ba = b - a;
	float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );
	return length( pa - ba*h ) - r;
}

#define N 360

float radius(float theta, float n) {
    theta += PI;
    return cos(PI/n)/cos(theta-2.0*PI/n*floor((n*theta+PI)/(2.0*PI)));
}

vec2 getPos(float n, float poly) {
    float theta = n / float(N) * 2.0 * PI;
    return vec2(cos(theta), sin(theta)) * radius(theta, poly);
}

void main() {
    vec2 newFragCoord = fragCoord;

    vec2 uv = -1.0 + 2.0 *vUv;

    uv.x *= iResolution.x / iResolution.y;
    uv *= 0.55;
    uv.xy = uv.yx;
    
    gl_FragColor.rgb = vec3(0);
    gl_FragColor.a = 1.0;
    
    // f table
    float f = floor(iTime);
    if (iMouse.z > 0.0) f = floor(iMouse.x * 0.1);
    
    // number of polygons
    float poly = 3.0 + floor((iResolution.y-iMouse.y) * 0.05);
    
    // change size on polygon size
    float top = radius(0.0, poly);
    float bot = -radius(PI, poly);
    float scale = top - bot;
    uv *= scale;
    uv.x += (top + bot) * 0.5;
    
    float acc = 0.0;
    
    // optimize a bit
    float theta = atan(uv.y, uv.x);
    float dist = length(uv) - radius(theta, poly);
    if (dist > 0.0) {
        acc = 1.0;
    } else {
        for (int i = 0 ; i <= N ; i++) {
            float fi = float(i);
            vec2 a = getPos(fi, poly);
            vec2 b = getPos(fi*f, poly);
            float dist = sdCapsule(uv, a, b, 0.0);
            acc += exp(-dist*100.0);
        }

        acc *= 70.0;
        acc /= float(N);
        acc = mix(acc, 1.0, smoothstep(-0.05, 0.0, dist));
    }
    
    gl_FragColor.rgb = hsv2rgb( vec3( acc*4.0, 1.0-acc, 1.0-acc));
    
}

</script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/90/three.js" type="text/javascript"></script>
    <!-- jquery js -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
    <!-- three js -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/90/three.js'></script> 
    <script src='https://cdnjs.cloudflare.com/ajax/libs/stats.js/r16/Stats.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.1/dat.gui.js'></script>

    <script src="js/out/goog/base.js" type="text/javascript"></script>
    <script src="js/app.js" type="text/javascript"></script>
    <script type="text/javascript">goog.require("singlepage_app_om.core");</script>
</html>
